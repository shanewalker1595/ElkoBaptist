<html>

<head>
    <title>Elko Baptist Church</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .header, .footer {
            background-image: linear-gradient(to top right, white, rgb(243, 242, 242));
            padding: 1em;
            position: relative;
        }
        .header {
            height: 200px;
            max-height: 20vw;
        }
        
        .header h1 {
            font-size: 4vw;
        }

        .headerimg {
            width: 100%;
            max-width: 150px;
        }
        
        .content {
            min-height: 20vw;
            padding: 2em;
        }

        .footer {
            height: 5em;
        }        
        
        .footer div {
            height: 100%;
        }
        
        .footertext {
            color: darkslategray;
            font-weight: bold;

        }
        
        .footerimg {
            width: 250px;
        }
        
        .hidden {
            display: none;
        }
        
        .centertext {
            text-align: center;
        }
        
        .righttext {
            text-align: right;
        }
        
        .fullwidth {
            width: 100%;
            height: 100%;
        }

        @media screen and (max-width: 800px) {
            .footertext { font-size: 3vw; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="row" style="background-image: url(https://storage.googleapis.com/elko/churchlogo.png); background-repeat: no-repeat; background-size: contain;">
                <div class="col-12">
                    <table class="fullwidth">
                        <tr>
                            <td>
                                <h1 class="centertext">Elko Baptist Church</h1>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="content">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="custom-file">
                        <input id="inFile" class="custom-file-input" type="file" />
                        <label class="custom-file-label" for="customFile">Choose file</label>
                    </div>
                </div>
            </div>
            <br />
            <br />
            <div class="row">
                <div class="col-12 centertext">
                    <button id="btnUploadFile" class="btn btn-primary btn-lg" value="Submit">Upload Video!</button>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div id="uploader" class="hidden">
                        Status of your upload:
                        <div class="progress">
                            <div id="Progress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="0"
                                aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <p id="progresstxt"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <table class="fullwidth">
                        <tr>
                            <td><span class="footertext">Storage and website powered by Google Cloud</span></td>
                            <td><img class="footerimg" src="https://storage.googleapis.com/elko/gcslogo.png"></img>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        ; $(function () {
            bsCustomFileInput.init()

            $("#btnUploadFile").click(function (evt) {
                var file = document.getElementById("inFile").files[0];
                $("#uploader").removeClass("hidden");
                $.ajax({
                    xhr: function () {
                        var xhr = new window.XMLHttpRequest();
                        // Progress Bar.
                        xhr.upload.addEventListener("progress", function (evt) {
                            if (evt.lengthComputable) {
                                var percentComplete = evt.loaded / evt.total;
                                percentComplete = parseInt(percentComplete * 100);
                                var txtPercent = percentComplete.toString().concat("%");
                                $("#Progress").width(txtPercent);
                                $("#progresstxt").text(txtPercent);
                            }
                        }, false);
                        // Handle browser based upload errors.
                        xhr.upload.addEventListener("error", function (evt) {
                            alert('There was an error uploading this file.');
                        });
                        // Handle good and bad response codes from server.
                        xhr.upload.addEventListener("load", function (evt) {
                            // 200 - 299 is a good range. 
                            if (evt.currentTarget.status > 199 && evt.currentTarget.status < 300) {
                                setTimeout(function() { document.location = "complete.html"; }, 1000);
                            }                         
                            else {
                                alert("There was an error uploading this file. HTTP Status Code:" + evt.currentTarget.status);
                                if (console) { console.log(evt.currentTarget); }
                            }
                        });
                        return xhr;
                    },
                    url: "https://storage.googleapis.com/elko/user_uploads/" + file.name,
                    type: "PUT",
                    data: file,
                    processData: false,
                    contentType: file.type
                });
            });
        });
    </script>
</body>
</html>
